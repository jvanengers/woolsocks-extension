import{c as j,j as e,r as p}from"./client-CwqcFquV.js";import{i as v,t as a}from"./i18n-ChiNe6Ig.js";async function x(){const i=await chrome.storage.local.get("wsAnonId");if(i?.wsAnonId)return i.wsAnonId;const l=crypto.randomUUID();return await chrome.storage.local.set({wsAnonId:l}),l}async function S(){try{const i=await x(),l=await fetch("https://woolsocks.eu/api/wsProxy/user-info/api/v0",{credentials:"include",headers:{"x-application-name":"WOOLSOCKS_WEB","x-user-id":i}});return l.ok?await l.json():null}catch{return null}}async function b(){try{const i=await x(),s=await fetch("https://woolsocks.eu/api/wsProxy/wallets/api/v0/transactions?excludeAutoRewards=false&direction=forward&limit=20&supportsJsonNote=true",{credentials:"include",headers:{"x-application-name":"WOOLSOCKS_WEB","x-user-id":i}});if(!s.ok)return[];const o=await s.json();try{console.debug("[WS] transactions raw",o)}catch{}let c=[];Array.isArray(o?.data?.transactions)?c=o.data.transactions:Array.isArray(o?.transactions)?c=o.transactions:Array.isArray(o?.data)?c=o.data:Array.isArray(o)?c=o:o?.data?.transactions?.data&&Array.isArray(o.data.transactions.data)&&(c=o.data.transactions.data);const u=c.map(t=>{const r=t?.merchant||t?.merchantInfo||{},f=r?.logoUrl||r?.logoURI||r?.logoUri||r?.logo||void 0,m=t?.createdAt||t?.created_at||t?.date||t?.eventDate,h=t?.recordState||t?.recordstate||t?.status||t?.state,d=typeof t?.amount=="number"?t.amount:typeof t?.amount?.amount=="number"?t.amount.amount:typeof t?.amount?.value=="number"?t.amount.value:typeof t?.amountCents=="number"?t.amountCents/100:void 0,y=typeof d=="number"?d:0;return{id:t?.id||`${r?.name||"txn"}-${m||Math.random()}`,amount:y,currency:t?.currencyCode||t?.currency||"EUR",merchantName:r?.name||"Unknown",logo:f,state:h||"unknown",recordType:t?.recordType||t?.type||"Unknown",createdAt:m||new Date().toISOString()}});return u.sort((t,r)=>new Date(r.createdAt).getTime()-new Date(t.createdAt).getTime()),u.slice(0,5)}catch{return[]}}function k(){const[i,l]=p.useState(null),[s,o]=p.useState(null),[c,u]=p.useState([]);p.useEffect(()=>{try{v()}catch{}t().then(n=>{l(n),n&&(r(),f())})},[]);async function t(){try{const n=await chrome.cookies.getAll({domain:"woolsocks.eu"}),w=await chrome.cookies.getAll({domain:"api.woolsocks.eu"});return[...n,...w].some(g=>g.name==="ws-session"||/session/i.test(g.name))}catch{return!1}}async function r(){const n=await S();o(n)}async function f(){const n=await b();u(n)}const m=()=>{chrome.tabs.create({url:"https://woolsocks.eu/nl/profile",active:!0})},h=s?.data?.firstName||s?.firstName||s?.user?.firstName,d=s?.data?.sockValue??s?.data?.cashback?.sockValue??s?.data?.cashbackSock??s?.data?.balance??s?.sockValue??s?.balance,y=typeof d=="number"?d:0;return e.jsxs("div",{style:{width:320,padding:16,borderRadius:12,background:"#fff",fontFamily:"system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{margin:0},children:a("options.title")}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:a("options.sectionTitle")})]}),i===null&&e.jsx("div",{style:{marginTop:24,fontSize:13,color:"#666"},children:a("options.checkingSession")}),i===!1&&e.jsxs("div",{style:{marginTop:24},children:[e.jsx("div",{style:{fontSize:14,marginBottom:12},children:a("options.noActiveSession")}),e.jsx("button",{onClick:m,style:{background:"#211940",color:"white",border:"none",borderRadius:6,padding:"10px 14px",fontSize:13,cursor:"pointer"},children:a("options.loginAtWs")})]}),i===!0&&e.jsxs("div",{style:{marginTop:24},children:[e.jsx("div",{style:{fontSize:16,fontWeight:600},children:a("options.greeting",{name:h||"there"})}),e.jsx("div",{style:{marginTop:8,fontSize:14,color:"#444"},children:a("options.cashbackSock")}),e.jsxs("div",{style:{fontSize:28,fontWeight:700,color:"#10B981"},children:["€",y.toFixed(2)]}),e.jsx("div",{style:{marginTop:16},children:e.jsx("button",{onClick:()=>{r(),f()},style:{background:"#f5f5f5",color:"#333",border:"1px solid #ddd",borderRadius:6,padding:"8px 12px",fontSize:12,cursor:"pointer"},children:a("options.refresh")})}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8},children:a("options.recentTransactions")}),c.length===0&&e.jsx("div",{style:{fontSize:12,color:"#666"},children:a("options.noRecentTransactions")}),e.jsx("div",{children:c.map(n=>e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"8px 0",borderTop:"1px solid #f0f0f0"},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:6,overflow:"hidden",background:"#f6f6f6",display:"flex",alignItems:"center",justifyContent:"center"},children:n.logo?e.jsx("img",{src:n.logo,alt:n.merchantName,style:{width:28,height:28,objectFit:"contain"}}):e.jsx("div",{style:{fontSize:10,color:"#999"},children:n.merchantName?.[0]||"?"})}),e.jsxs("div",{style:{flex:1,marginLeft:10},children:[e.jsx("div",{style:{fontSize:13,fontWeight:600},children:n.recordType==="Expense"?a("options.payoutToIban"):n.merchantName}),e.jsxs("div",{style:{fontSize:11,color:"#777"},children:[new Date(n.createdAt).toLocaleDateString()," · ",n.state||a("options.pending")]})]}),e.jsxs("div",{style:{fontSize:13,fontWeight:700,color:n.amount>=0?"#059669":"#ef4444"},children:["€",n.amount.toFixed(2)]})]},n.id))}),e.jsx("div",{style:{marginTop:12,textAlign:"center"},children:e.jsx("button",{onClick:()=>chrome.tabs.create({url:"https://woolsocks.eu/nl-NL/profile",active:!0}),style:{background:"transparent",color:"var(--action-link-default, #0084FF)",fontFamily:"Woolsocks, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif",fontSize:14,fontStyle:"normal",fontWeight:500,lineHeight:"130%",border:"none",padding:0,cursor:"pointer"},children:a("options.viewAllTransactions")})})]})]})]})}const A=j.createRoot(document.getElementById("root"));A.render(e.jsx(k,{}));
