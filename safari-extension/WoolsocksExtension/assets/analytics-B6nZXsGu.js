const m="G-F8VGS98X04",h="rZFsprlfRROU2_1nIqvLnA",u="__wsAnalyticsConfig",o="__wsAnalyticsQueue";let n=[],r=!1,f=!1;async function g(){let t=(await chrome.storage.local.get("wsAnonId"))?.wsAnonId;return t||(t=crypto.randomUUID(),await chrome.storage.local.set({wsAnonId:t})),t}async function p(){const t=(await chrome.storage.local.get(u))?.[u]||{},s=t.measurementId||m,a=t.apiSecret||h;return{measurementId:s,apiSecret:a}}async function y(){try{const e=await chrome.storage.local.get(o),t=Array.isArray(e?.[o])?e[o]:[];t.length&&n.push(...t)}catch{}}async function d(){try{await chrome.storage.local.set({[o]:n})}catch{}}async function w(e,t){try{const s=chrome.runtime.getManifest().version,a=Date.now(),c={...t,ext_version:s,ts:a};n.push({name:e,params:c}),n.length>=10?i():d()}catch{}}function _(){f||(f=!0,y().then(()=>{i()}),setInterval(()=>{n.length&&i()},6e4))}async function i(){if(r)return;const e=await p();if(e&&n.length){r=!0;try{const t=n.splice(0,20),s=await g(),a=`https://www.google-analytics.com/mp/collect?measurement_id=${encodeURIComponent(e.measurementId)}&api_secret=${encodeURIComponent(e.apiSecret)}`,c={client_id:s,non_personalized_ads:!0,events:t.map(l=>({name:l.name,params:l.params}))};await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})}catch{try{n=[...n]}catch{}}finally{await d(),r=!1}}}export{_ as i,w as t};
