import{b as F}from"./browser-polyfill-D6ovI04A.js";try{console.debug("[Woolsocks] checkout script")}catch{}async function E(t){try{await F.storage.local.set({checkout_detected:{merchant:t.merchant,timestamp:t.timestamp,cartValue:t.total,currency:t.currency,url:window.location.href}});try{sessionStorage.setItem("__wsLastCheckout",JSON.stringify(t))}catch{}}catch(n){console.debug("[Woolsocks] Failed to write checkout to App Groups:",n)}}function l(t){if(!t)return null;const n=String(t).replace(/[\u00A0\u2007\u202F]/g," ").trim();let o=n.replace(/€|eur|euro/gi,"").replace(/[\u00A0\u2007\u202F]/g," ").trim();if(o=o.replace(/\s+/g," "),o=o.replace(/,?-\s*$/,""),o=o.replace(/[^\d.,\s]/g,""),!o)return null;const c=o.match(/^(\d{1,4})(?:\s+)(\d{2})$/);if(c){const m=c[1],p=c[2],h=parseFloat(`${m}.${p}`);if(Number.isFinite(h))return h}const e=o.lastIndexOf("."),r=o.lastIndexOf(",");let s=null;const a=m=>m.replace(/[^\d]/g,"");if(e>r&&e!==-1){const m=o.slice(e+1),p=a(m);p.length>=1&&p.length<=2&&(s=parseFloat(o.replace(/,/g,"")))}else if(r>e&&r!==-1){const m=o.slice(r+1),p=a(m);p.length>=1&&p.length<=2&&(s=parseFloat(o.replace(/\./g,"").replace(",",".")))}else r!==-1&&/,\s*\d{1,2}(\D|$)/.test(o)?s=parseFloat(o.replace(/\./g,"").replace(",",".")):e!==-1&&/\.\s*\d{1,2}(\D|$)/.test(o)&&(s=parseFloat(o.replace(/,/g,"")));if(s===null){const m=o.replace(/[.,\s]/g,"");s=parseFloat(m)}if(!Number.isFinite(s)||s<=0||(s.toString().split(".")[1]||"").length>2||Math.floor(s)>9999||s<.01)return null;const d=/^\s*\d{1,3}\s*,\s*\d{2}\s*$/,f=r>e&&r!==-1&&/,\s*\d{1,2}(\D|$)/.test(o);if(s>=1e3&&d.test(n.replace(/€|eur|euro/gi,"").trim())&&!f){const m=s/100;if(Number.isFinite(m))return m}return s}function z(t){try{const n=t.getBoundingClientRect();if(!n||n.width===0||n.height===0)return!1;const o=window.getComputedStyle(t);return!(o.display==="none"||o.visibility==="hidden"||o.opacity==="0")}catch{return!0}}function S(t){try{let n=t;for(;n;){const o=n.id||"",c=n.className?.toString()||"";if(o.includes("woolsocks")||c.includes("woolsocks"))return!0;n=n.parentElement}}catch{}return!1}function y(){const t=["aside",'[class*="summary"]','[id*="summary"]',".order-summary",".checkout-summary",".cart-summary",".basket-summary",".order-total",".cart-totals",".basket-total","#orderSummary","#order-summary",'[class*="totals"]','[id*="totals"]','[data-testid*="summary"]','[data-testid*="order-summary"]','[class*="checkout"] [class*="summary"]','[class*="cart"] [class*="summary"]'],n=Array.from(document.querySelectorAll(t.join(","))).filter(e=>!S(e)),o=n.length>0?n:[document.body],c=/(totaal|total|grand\s*total|order\s*total|te\s*betalen|payable|summe|gesamt|totaalbedrag|total incl)/i;o.sort((e,r)=>{const s=c.test(e.textContent||"")?1:0;return(c.test(r.textContent||"")?1:0)-s});for(const e of o){const r=Array.from(e.querySelectorAll("span, div, p, li, td, th, strong, b, h1, h2, h3, h4, h5, h6")),s=[];for(const a of r){if(S(a)||!z(a))continue;const u=a.textContent||"",i=l(u);if(!i||i<=0)continue;const d=a.getBoundingClientRect(),f=a.closest("tr, li, div, p"),m=(f?.textContent||"").toLowerCase();let p=0;/(totaal|total|grand\s*total|order\s*total|te\s*betalen|payable|total incl|total\s*incl\.|due\s*today|to\s*pay)/i.test(m)&&(p+=10),/(subtotaal|subtotal)/i.test(m)&&(p-=5),/(verzend|shipping|bezorg|delivery|tax|btw|vat|korting|discount)/i.test(m)&&(p-=3);try{const h=f?.parentElement?.children||[];for(const g of Array.from(h)){if(g===a)continue;const C=g.getBoundingClientRect(),q=Math.abs(C.top-d.top)<=6,x=C.left<d.left;if(q&&x){const _=(g.textContent||"").toLowerCase();/(totaal|total|grand\s*total|order\s*total|te\s*betalen|payable|totaalbedrag|total incl)/i.test(_)&&(p+=8),/(subtotaal|subtotal)/i.test(_)&&(p-=4),/(verzend|shipping|bezorg|delivery|tax|btw|vat|korting|discount)/i.test(_)&&(p-=3)}}}catch{}s.push({amount:i,top:d.top+window.scrollY,left:d.left+window.scrollX,score:p})}if(s.length>0){const a=s.filter(d=>d.score>=5),u=(a.length>0?a:s).sort((d,f)=>f.score!==d.score?f.score-d.score:d.top!==f.top?d.top-f.top:d.left-f.left),i=u[u.length-1];if(i&&i.amount>0)return i.amount}}return null}function A(t){if(!t)return null;const n=[/€\s*[\d.,\s]+/g,/[\d.,\s]+€/g,/\b[\d.,\s]+(?:,-|\.00)?\b/g],o=[];for(const c of n){const e=t.match(c)||[];for(const r of e){const s=l(r);s&&s>0&&o.push(s)}}return o.length>0?Math.max(...o):null}window.addEventListener("message",t=>{try{if(t.source!==window)return;const n=t.data;if(!n||typeof n!="object")return;if(n.type==="WS_OPEN_URL"&&typeof n.url=="string")try{chrome.runtime.sendMessage({type:"OPEN_URL",url:n.url})}catch{}}catch{}});let P=!1;function W(){try{chrome.runtime.sendMessage({type:"CHECK_MERCHANT_SUPPORT",hostname:window.location.hostname},()=>{P=!0})}catch{}}function L(t){try{const n=window.localStorage.getItem("__wsVoucherDismissals");if(!n)return!1;const o=JSON.parse(n),c=o&&typeof o[t]=="number"?o[t]:0;return Date.now()<c}catch{try{const n=document.documentElement.getAttribute("data-ws-voucher-dismissed-until"),o=n?parseInt(n,10):0;return Date.now()<o}catch{return!1}}}let k=null,w=null,v=0;const N=10;function T(){w&&(clearTimeout(w),w=null),v=0}function D(t){if(v>=N)return;const o=Math.min(500*Math.pow(2,v),8e3);v+=1,w&&clearTimeout(w),w=window.setTimeout(()=>{t()},o)}const j={isCheckoutPage:()=>{const t=window.location.href;return t.includes("/gp/cart")||t.includes("/checkout")||t.includes("/cart")||document.querySelector('[data-testid="order-summary"]')!==null},extractTotal:()=>{const t=['[data-testid="order-summary"] [data-testid="total-price"]',".a-size-medium.a-color-base.sc-price","#orderSummary .a-color-price",".sc-price"];for(const n of t){const o=document.querySelector(n);if(o){const e=(o.textContent||"").match(/€?\s*([\d.,\s-]+)/);if(e){const r=l(e[1]);if(r&&r>0)return r}}}{const n=y();if(n&&n>0)return n}return null},getCurrency:()=>"EUR"},B={isCheckoutPage:()=>{try{const t=window.location.href;return/^https?:\/\/www\.xenos\.nl\//i.test(t)&&!/\/checkout\/cart/i.test(t)?!1:/\/checkout\/cart/i.test(t)}catch{return!1}},extractTotal:()=>{const n=document.querySelector("#solar-app > div.checkout-cart > div > div > div > div.cart__container > div > div.medium-offset-1.medium-8.cell.gray-wrapper--cart > div > div.cart__totals > div.--grand-total");if(n){const c=(n.querySelector("span")?.textContent||"").trim().toLowerCase();if(/eindtotaal/i.test(c)){const e=n.querySelector("span:nth-of-type(2)"),r=l(e?.textContent);if(r&&r>0)return r}}const o=document.querySelectorAll("div.--grand-total, .cart__totals div");for(const c of Array.from(o)){const e=(c.textContent||"").toLowerCase();if(/eindtotaal/.test(e)&&/€/.test(e)){const r=l(c.textContent);if(r&&r>0)return r}}return null},getCurrency:()=>"EUR"},I={isCheckoutPage:()=>{try{const t=window.location.href;return/https?:\/\/www\.beterbed\.nl\/Winkelwagen/i.test(t)}catch{return!1}},extractTotal:()=>{const t=document.querySelectorAll("#cart-form > div.cart-item-footer > div > div.col-lg-8 > table > tfoot > tr");for(const o of Array.from(t)){const c=(o.querySelector("td")?.textContent||"").trim().toLowerCase();if(/eindbedrag/.test(c)){const e=o.querySelector(".pricing-summary__price-text, td:last-of-type, span"),r=l(e?.textContent||o.textContent||"");if(r&&r>0)return r}/verzendkosten/i.test(c)}const n=document.querySelectorAll("tr");for(const o of Array.from(n)){const c=(o.textContent||"").toLowerCase();if(/eindbedrag/.test(c)){const e=l(o.textContent);if(e&&e>0)return e}}return null},getCurrency:()=>"EUR"},O={isCheckoutPage:()=>{try{const t=window.location.href;return/https?:\/\/www\.dille-kamille\.nl\/checkout\/cart\/?$/i.test(t)}catch{return!1}},extractTotal:()=>{const t=document.querySelectorAll("#cart-totals > div > table > tbody > tr.grand.totals.incl");for(const o of Array.from(t)){const c=(o.querySelector("th, .mark")?.textContent||"").trim().toLowerCase();if(!/subtotaal|verzending/.test(c)&&(/totaal\s*\(incl\.?\s*btw\)/i.test(c)||/totaal/i.test(c))){const e=o.querySelector("span.price, td.amount, strong, span"),r=l(e?.textContent||o.textContent||"");if(r&&r>0)return r}}const n=document.querySelectorAll("tr");for(const o of Array.from(n)){const c=(o.textContent||"").toLowerCase();if(/totaal\s*\(incl\.?\s*btw\)/i.test(c)){const e=l(o.textContent);if(e&&e>0)return e}}return null},getCurrency:()=>"EUR"},$={isCheckoutPage:()=>{try{const t=window.location.href;return/https?:\/\/m\.uber\.com\//i.test(t)?/\/go\//i.test(t):!1}catch{return!1}},extractTotal:()=>{const t=[],o=document.querySelector("#wrapper > div.css-dqxzrQ > div > main > div > section > div.css-kirxzG > div > ul > li.css-hqmvdp");o&&t.push(o);const c=Array.from(document.querySelectorAll("p.css-iQlrzm"));t.push(...c);for(const e of t){const r=(e.textContent||"").trim(),s=l(r);if(s&&s>0)return s;const a=e.querySelector("p.css-iQlrzm, .price, span"),u=l(a?.textContent||"");if(u&&u>0)return u}return null},getCurrency:()=>"EUR"},V={isCheckoutPage:()=>{const t=window.location.hostname.toLowerCase(),n=window.location.pathname;return t.includes("efteling.com")&&/tickets\/bestellen\/afronden\/betalen/i.test(n)},extractTotal:()=>{const t=["#content > section > div > div > div:nth-child(2) > div > div > div.BasketSummary_basketLine__T2kYv > span","span.BasketSummary_totalPrice__xKeTE","span.BasketSummary_price__yHLAW"];for(const o of t){const c=document.querySelector(o);if(c){const e=l(c.textContent||"");if(e&&e>0)return e}}const n=Array.from(document.querySelectorAll("*"));for(const o of n){const c=(o.textContent||"").trim().toLowerCase();if(/totaalprijs/.test(c)){const r=(o.closest("div, section, aside")||o).querySelector("span"),s=l(r?.textContent||"");if(s&&s>0)return s}}return null},getCurrency:()=>"EUR"},K={isCheckoutPage:()=>{const t=window.location.hostname.toLowerCase(),n=window.location.pathname.toLowerCase();return t.includes("gall.nl")&&/\/winkelmand\/?$/.test(n)},extractTotal:()=>{const t=["#content > div:nth-child(2) > div > div:nth-child(3) > div > div > div.o-col-12.o-col-5--lg > section > div > div.cart-summary_grand-total > span","span.cart-summary_grand-total-sum[data-hook-adjusted-grand-total]"];for(const o of t){const c=document.querySelector(o);if(c){const e=l(c.textContent||"");if(e&&e>0)return e}}const n=document.querySelector(".cart-summary_grand-total")||document.querySelector('section [class*="cart-summary"]');if(n){const o=Array.from(n.querySelectorAll("span"));for(let c=o.length-1;c>=0;c--){const e=l(o[c].textContent||"");if(e&&e>0)return e}}return null},getCurrency:()=>"EUR"},G={isCheckoutPage:()=>{const t=window.location.hostname.toLowerCase(),n=window.location.pathname.toLowerCase();return t.includes("prenatal.nl")?/\/checkout\//.test(n)||/\/checkout\/cart\/index\//.test(n):!1},extractTotal:()=>{const t=["#cart-totals > div:nth-child(7) > div > div.w-auto > div > div","div.text-right.text-xl.price.end-total"];for(const e of t){const r=document.querySelector(e);if(r){const s=l(r.textContent||"");if(s&&s>0)return s}}const n=["#opc-sidebar > div.opc-block-summary > table > tbody > tr.grand.totals > td > strong > span.price","tr.grand.totals span.price"];for(const e of n){const r=document.querySelector(e);if(r){const s=l(r.textContent||"");if(s&&s>0)return s}}const o=/(subtotaal|aflevering|verwerking|verzendkosten|btw)/i,c=Array.from(document.querySelectorAll("div, span, td, p, strong"));for(const e of c){const r=(e.textContent||"").trim().toLowerCase();if(/totaal\b/i.test(r)&&!o.test(r)){const a=(e.closest("tr, div, section, aside")||e).querySelector("span.price, .price, div.price, td, span"),u=l(a?.textContent||e.nextElementSibling?.textContent||"");if(u&&u>0)return u}}return null},getCurrency:()=>"EUR"},H={isCheckoutPage:()=>{const t=window.location.hostname.toLowerCase(),n=window.location.pathname.toLowerCase();return t.includes("cadeaubon.nl")&&/winkelmandje/.test(n)},extractTotal:()=>{const t=["#__next > div > div > div > div.LoadingWrapper_loadingWrapper__BiuRg.Layout_fullScreen__1Snsu > div > div > div > div > div > div > div.BasketV2_sideInfoContainer__BUv7x > div.BasketV2_totalOrderAmountWrapper__pGxI7 > div > div:nth-child(3) > div:nth-child(2) > p:nth-child(2)","div.BasketV2_totalOrderAmountWrapper__pGxI7 p.Typography_root__0otb6.Typography_bodySubText2__FvjML.Typography_primary__GXt_0"];for(const o of t){const c=document.querySelector(o);if(c){const e=l(c.textContent||"");if(e&&e>0)return e}}const n=document.querySelector(".BasketV2_totalOrderAmountWrapper__pGxI7");if(n){const o=/(verzendkosten|digitale\s+cadeaukaarten|totaal\s+excl\.?\s*btw)/i,c=Array.from(n.querySelectorAll("div, p, span"));for(let e=c.length-1;e>=0;e--){const r=(c[e].textContent||"").trim();if(o.test(r.toLowerCase()))continue;const s=l(r);if(s&&s>0)return s}}return null},getCurrency:()=>"EUR"},Q={isCheckoutPage:()=>{const t=window.location.hostname.toLowerCase(),n=window.location.href.toLowerCase();return t.includes("airbnb")?n.includes("/book/")||n.includes("/checkout")||n.includes("/payments")||n.includes("/confirm"):!1},extractTotal:()=>{const t=['[data-testid*="total"]','[class*="total"]','[class*="price"]','[data-testid*="price"]'];for(const n of t){const o=document.querySelectorAll(n);for(const c of Array.from(o)){const e=l(c.textContent);if(e&&e>0)return e}}return null},getCurrency:()=>"EUR"},X={isCheckoutPage:()=>{const t=window.location.href;return t.includes("/cart")||t.includes("/checkout/confirm")||t.includes("/checkout/payment")||document.querySelector('[data-testid="checkout-summary"]')!==null},extractTotal:()=>{const t=document.querySelector('div[data-id="total-price"]');if(t){const e=l(t.textContent);if(e&&e>0)return e}const n=['[data-testid="checkout-summary"] [data-testid="total-price"]',".checkout-summary__total .price",".total-price"];for(const e of n){const r=document.querySelector(e);if(r){const s=l(r.textContent);if(s&&s>0)return s}}const c=(document.body.textContent||"").match(/(?:totaal|sum|total|gesamt|bedrag)[^\n€]*€\s*([\d.,]+)/i);if(c){const e=l(c[1]);if(e&&e>0)return e}return null},getCurrency:()=>"EUR"},Y={isCheckoutPage:()=>{const t=window.location.href;return t.includes("/checkout")||t.includes("/cart")||t.includes("/basket")||document.querySelector(".checkout-summary")!==null},extractTotal:()=>{const t=Array.from(document.querySelectorAll('div.p-4.my-4.bg-accent1-background-low, div[class*="bg-accent1-background-low"], div[aria-live]'));for(const r of t){const s=(r.textContent||"").toLowerCase();if(/nog\s*te\s*betalen/.test(s)){const u=Array.from(r.querySelectorAll("strong")).reverse().find(i=>/€\s*[\d.,\u00A0\s]+/.test(i.textContent||""));if(u){const i=l(u.textContent);if(i&&i>0)return i}}}const n=Array.from(document.querySelectorAll("span, div, strong, p")).filter(r=>/nog\s*te\s*betalen/i.test(r.textContent||""));for(const r of n){let s=r.closest("div, section, article, aside, tr");for(let a=0;a<6&&s;a++){const i=Array.from(s.querySelectorAll("strong, span, div")).filter(f=>/€\s*[\d.,\u00A0\s]+/.test(f.textContent||"")),d=i[i.length-1];if(d){const f=l(d.textContent);if(f&&f>0)return f}s=s.parentElement}}const e=(((document.querySelector("#mainContent")||document.body).textContent||"").match(/€\s*[\d.,\u00A0\s]+/g)||[]).map(r=>l(r)).filter(r=>typeof r=="number"&&r>0);return e.length?Math.max(...e):null},getCurrency:()=>"EUR"},J={isCheckoutPage:()=>{const t=window.location.hostname.toLowerCase(),n=window.location.href.toLowerCase(),o=window.location.pathname.toLowerCase();return["wikipedia.org","github.com","stackoverflow.com","reddit.com","youtube.com","facebook.com","twitter.com","instagram.com","linkedin.com","tiktok.com","snapchat.com","pinterest.com","bbc.com","cnn.com","nu.nl","telegraaf.nl","ad.nl","coursera.org","edx.org","khanacademy.org","udemy.com","rijksoverheid.nl","belastingdienst.nl","digid.nl","overheid.nl","google.com","microsoft.com","apple.com/support","developer.",".gov",".edu",".org/wiki","news.","blog.","help.","support."].some(a=>t.includes(a)||n.includes(a))?!1:["checkout","cart","basket","bag","order","payment","purchase","shopping-cart","shoppingcart","shopping-basket","shoppingbasket","checkout/cart","order/delivery","order/checkout","checkout/order","page/checkout","checkout/","/checkout","checkout-page","book","reserve","booking","reservation","betalen","kassa","winkelmand","winkelwagen","winkelmandje","bestellen","afrekenen","bestelling","afrekening","reserveren","boeken","buy","buy-now","purchase","complete-order","place-order","finalize","confirm-order","order-summary","order-review"].some(a=>o.includes(a)||n.includes(a))},extractTotal:()=>{const t=['[class*="total"]','[class*="sum"]','[class*="amount"]','[class*="price"]','[id*="total"]','[id*="sum"]','[id*="amount"]','[id*="price"]','[data-testid*="total"]','[data-testid*="sum"]','[data-testid*="amount"]',".checkout-summary",".order-summary",".cart-summary",".basket-summary",".payment-summary",".order-total",".cart-total",".basket-total"],n=[];for(const e of t){const r=document.querySelectorAll(e);for(const s of r){if(S(s))continue;const a=l(s.textContent);if(!a||a<=0)continue;const u=s.getBoundingClientRect();let i=0;const d=(s.className||"").toString().toLowerCase();/total|grand|totaal/.test(d)&&(i+=6),/price|amount|sum/.test(d)&&(i+=2);const f=s.closest("tr, li, div, p"),m=(f?.textContent||"").toLowerCase();/(totaal|total|grand\s*total|order\s*total|te\s*betalen|payable|total incl)/.test(m)&&(i+=8),/(subtotaal|subtotal)/.test(m)&&(i-=4),/(verzend|shipping|bezorg|delivery|tax|btw|vat|korting|discount)/.test(m)&&(i-=3);try{const p=f?.parentElement?.children||[];for(const h of Array.from(p)){if(h===s)continue;const g=h.getBoundingClientRect(),C=Math.abs(g.top-u.top)<=6,q=g.left<u.left;if(C&&q){const x=(h.textContent||"").toLowerCase();/(totaal|total|grand\s*total|order\s*total|te\s*betalen|payable)/.test(x)&&(i+=6),/(subtotaal|subtotal)/.test(x)&&(i-=3)}}}catch{}n.push({amount:a,top:u.top+window.scrollY,left:u.left+window.scrollX,score:i})}}if(n.length>0){const e=n.sort((s,a)=>a.score!==s.score?a.score-s.score:s.top!==a.top?s.top-a.top:s.left-a.left),r=e[e.length-1];if(r&&r.amount>0)return r.amount}const o=[/(?:total|totaal|bedrag|amount|sum)[\s:]*€?\s*([\d.,\s-]+)/i,/€\s*([\d.,\s-]+)\s*(?:total|totaal|bedrag|amount|sum)/i,/(?:order\s+total|cart\s+total|basket\s+total)[\s:]*€?\s*([\d.,\s-]+)/i,/(?:checkout\s+total|payment\s+total)[\s:]*€?\s*([\d.,\s-]+)/i];for(const e of o){const r=document.body.textContent?.match(e);if(r){const s=l(r[1]);if(s&&s>0)return s}}const c=y();return c&&c>0?c:A(document.body.textContent||"")},getCurrency:()=>"EUR"},Z={isCheckoutPage:()=>{const t=window.location.pathname;return/nike\.com/i.test(window.location.hostname)&&(/\/cart/i.test(t)||/\/checkout/i.test(t))},extractTotal:()=>{const t=["#maincontent > div > div.css-1k22aut.e1fdruzw1 > div.css-1q08mzu.e1fdruzw3 > aside > div.css-1enpgf9.e103o6nq3 > div > span > span > span","span.formatted-price","#checkout-wrapper [data-attr='cart-total']","#checkout-wrapper > div > div > aside > section > div > div.ncss-row > div > div.ncss-row.mt2-sm > div.ncss-col-sm-4.va-sm-t.ta-sm-r"];for(const c of t){const e=document.querySelector(c);if(e){const r=l(e.textContent);if(r&&r>0)return r}}const n=Array.from(document.querySelectorAll("*, *:before, *:after"));for(const c of n){const e=(c.textContent||"").trim().toLowerCase();if(/^total\b|\btotal\b|\(incl\.?\s*btw\)/i.test(e)){const s=(c.closest("aside, section, div, li")||c).querySelector("span, div, p"),a=l(s?.textContent||c.nextElementSibling?.textContent||"");if(a&&a>0)return a}}const o=document.querySelector('aside, [class*="summary"], [class*="order"]');if(o){const c=Array.from(o.querySelectorAll("span, div, p")).map(e=>l(e.textContent||"")).filter(e=>!!e&&e>0);if(c.length)return c[c.length-1]}return null},getCurrency:()=>"EUR"},tt={isCheckoutPage:()=>{const t=window.location.href.toLowerCase(),n=window.location.pathname.toLowerCase(),o=t.includes("/cart")||t.includes("/checkout")||n==="/winkelmandje"||n.includes("winkelmand")||n.includes("winkelwagen"),c=document.querySelector('[class*="summary"], .checkout-summary, .order-summary')!==null;return o||c},extractTotal:()=>{const t=['.checkout-summary [class*="total"]','.order-summary [class*="total"]','.order-summary [class*="price"]','[data-testid="total-price"]','[data-test="total-price"]','[id*="total"],[class*="total"] [class*="price"]'];for(const e of t){const r=document.querySelectorAll(e);for(const s of Array.from(r)){const a=l(s.textContent);if(a&&a>0)return a}}const n=Array.from(document.querySelectorAll('aside, [class*="summary"], [class*="Samenvatting"], [class*="basket"], [class*="order"], [class*="checkout"], [class*="winkelmand"]'));for(const e of n){const r=e.textContent||"",s=r.match(/(?:totaalbedrag|totaal|total)[^€]*€\s*([\d.,]+)/i);if(s){const u=parseFloat(s[1].replace(/\./g,"").replace(",","."));if(!isNaN(u)&&u>0)return u}const a=A(r);if(a&&a>0)return a}const o=document.body.textContent||"",c=o.match(/(?:totaalbedrag|totaal|total)[^€]*€\s*([\d.,]+)/i);if(c){const e=parseFloat(c[1].replace(/\./g,"").replace(",","."));if(!isNaN(e)&&e>0)return e}return A(o)},getCurrency:()=>"EUR"},et={isCheckoutPage:()=>{const t=window.location.href,n=t.includes("/checkout")||t.includes("/checkout/payment")||t.includes("/cart"),o=!!document.querySelector('[data-test="checkout-payment-page"]'),c=!!document.querySelector('#totalPriceWrapper, [data-test="checkout-total"], h3.sc-94eb08bc-0.gZiaJK');return n&&(o||c)},extractTotal:()=>{const t=['#totalPriceWrapper [data-test="checkout-total"] span','[data-test="checkout-total"] span',"#totalPriceWrapper span"];for(const c of t){const e=document.querySelector(c);if(e&&e.textContent){const r=e.textContent.match(/€\s*([\d.,]+)/);if(r)return parseFloat(r[1].replace(".","").replace(",","."))}}const n=Array.from(document.querySelectorAll('aside, [class*="summary"], [class*="Samenvatting"], [class*="basket"], [class*="order"], [class*="checkout"]'));for(const c of n){const e=c.textContent||"";if(/(totaal|samenvatting|total)/i.test(e)){const r=e.match(/€\s*([\d.,]+)/);if(r)return parseFloat(r[1].replace(".","").replace(",","."))}}const o=document.querySelectorAll('[class*="checkout"], [class*="cart"], [class*="order"], [class*="payment"], #totalPriceWrapper');for(const c of o){const r=(c.textContent||"").match(/(?:totaal|total)[^\n€]*€\s*([\d.,]+)/i);if(r)return parseFloat(r[1].replace(".","").replace(",","."))}return null},getCurrency:()=>"EUR"},ot={isCheckoutPage:()=>{const t=window.location.href;return t.includes("/shoppingcart")||t.includes("/order/delivery")||t.includes("/checkout")||document.querySelector('[data-testid="checkout"]')!==null},extractTotal:()=>{const t=['[data-testid="checkout-total"]',".checkout-summary .total",".order-summary .total",'[class*="total"] [class*="price"]'];for(const c of t){const e=document.querySelector(c);if(e){const r=l(e.textContent);if(r&&r>0)return r}}const o=(document.body.textContent||"").match(/(?:totaal|total)[^\n€]*€?\s*([\d.,\s-]+)/i);if(o){const c=l(o[1]);if(c&&c>0)return c}return null},getCurrency:()=>"EUR"},rt={isCheckoutPage:()=>{const t=window.location.href;return t==="https://www.hema.nl/cart"||t.endsWith("/cart")?!0:document.querySelector("#cart .basket-totals.calculated-totals")!==null},extractTotal:()=>{const t=document.querySelector("#cart .basket-totals.calculated-totals .total-prices.redesign .row.total-amount span.price");if(t){const o=l(t.textContent);if(o&&o>0)return o}const n=document.querySelector("#cart .basket-totals.calculated-totals .total-prices.redesign");if(n){const o=n.querySelector(".row.total-amount span.price"),c=l(o?.textContent);if(c&&c>0)return c;const e=n.querySelectorAll(".row");for(const r of Array.from(e)){const a=(r.querySelector(".price-label, .total-label, span")?.textContent||"").toLowerCase().trim();if(/^(totaal|total)$/i.test(a)){const i=r.querySelector("span.price"),d=l(i?.textContent);if(d&&d>0)return d}}}if(n){const c=(n.textContent||"").match(/totaal[^€\d]*([€]?[\s\d.,-]+)/i);if(c){const e=l(c[1]);if(e&&e>0)return e}}{const o=document.querySelectorAll("#cart .basket-totals.calculated-totals");for(const c of Array.from(o)){const e=y();if(e&&e>0)return e}}return null},getCurrency:()=>"EUR"},nt={isCheckoutPage:()=>{const t=window.location.href;return t.includes("/checkout/cart")||t.includes("/checkout")||document.querySelector('[class*="cart"]')!==null},extractTotal:()=>{const t=['[class*="total"] [class*="price"]','[class*="cart"] [class*="total"]',".checkout-summary .total"];for(const c of t){const e=document.querySelector(c);if(e){const s=(e.textContent||"").match(/€\s*([\d.,]+)/);if(s)return parseFloat(s[1].replace(".","").replace(",","."))}}const o=(document.body.textContent||"").match(/(?:totaal|total)[^\n€]*€\s*([\d.,]+)/i);return o?parseFloat(o[1].replace(".","").replace(",",".")):null},getCurrency:()=>"EUR"},ct={isCheckoutPage:()=>{const t=window.location.href;return t.includes("/cart")||t.includes("/checkout")||document.querySelector('[class*="cart"]')!==null},extractTotal:()=>{const t=['[class*="total"] [class*="price"]','[class*="cart"] [class*="total"]',".checkout-summary .total"];for(const c of t){const e=document.querySelector(c);if(e){const s=(e.textContent||"").match(/€\s*([\d.,]+)/);if(s)return parseFloat(s[1].replace(".","").replace(",","."))}}const o=(document.body.textContent||"").match(/(?:totaal|total)[^\n€]*€\s*([\d.,]+)/i);return o?parseFloat(o[1].replace(".","").replace(",",".")):null},getCurrency:()=>"EUR"},st={isCheckoutPage:()=>{const t=window.location.href,n=t.includes("/page/checkout")||t.includes("/checkout"),o=document.querySelector(".TotalsContainer_sMjF, .TotalPrice_jfub, .SellingPrice-module_Label")!==null;return n||o},extractTotal:()=>{const t=document.querySelector("li.TotalPrice_jfub .SellingPrice-module_Label, .SellingPrice-module_Label");if(t){const o=l(t.textContent);if(o&&o>0)return o}const n=document.querySelector(".TotalsContainer_sMjF");if(n){const c=(n.textContent||"").match(/totaal[^€]*€?\s*([\d.,]+)/i);if(c){const e=l(c[1]);if(e&&e>0)return e}}{const o=document.querySelectorAll(".TotalsContainer_sMjF, .BasketPage_bnQ1");for(const c of Array.from(o)){const e=y();if(e&&e>0)return e}}return null},getCurrency:()=>"EUR"},at={isCheckoutPage:()=>{const t=window.location.href,n=t.includes("/cart")||t.includes("/checkout"),o=document.querySelector(".js-cart-totals, .total-summary__totals, .cart-totals__amounts")!==null;return n||o},extractTotal:()=>{const t=document.querySelector(".total-summary__totals .o-grid.u-flex-bottom.u-text--big b.u-flex-self-right");if(t){const c=l(t.textContent);if(c&&c>0)return c}const n=document.querySelectorAll(".total-summary__totals .o-grid, .cart-totals__amounts .o-grid");for(const c of Array.from(n)){const r=(c.querySelector(".o-col-6, .o-col-6.u-flex, .u-text--left")?.textContent||"").toLowerCase();if(/\btotaal\b/.test(r)){const s=c.querySelector("b.u-flex-self-right, .u-text--right, strong, b, span"),a=l(s?.textContent);if(a&&a>0)return a}}const o=document.querySelector(".cart-totals__amounts, .total-summary__totals");if(o){const e=(o.textContent||"").match(/totaal[^€]*€\s*([\d.,]+)/i);if(e){const r=l(e[1]);if(r&&r>0)return r}}{const c=document.querySelectorAll(".cart-totals__amounts, .total-summary__totals");for(const e of Array.from(c)){const r=y();if(r&&r>0)return r}}return null},getCurrency:()=>"EUR"},lt={isCheckoutPage:()=>{const t=window.location.href,n=t.includes("/cart")||t.includes("/checkout"),o=document.querySelector(".cart-calculations, .cart-calculations__loyalty--total")!==null;return n||o},extractTotal:()=>{const t=document.querySelector('.cart-calculations__loyalty--total .cart-calculations__price--bold [data-testid="price-type-none"]');if(t){const r=l(t.textContent);if(r&&r>0)return r}const n=document.querySelector(".cart-calculations");if(n){const r=n.querySelectorAll(".row, .cart-calculations__row, .cart-calculations__loyalty");for(const s of Array.from(r)){const a=(s.textContent||"").toLowerCase();if(/\btotaal\b/.test(a)||/\btotal\b/.test(a)){const u=s.querySelector('[data-testid="price-type-none"], .cart-calculations__price--bold, .cart-calculations__price'),i=l(u?.textContent);if(i&&i>0)return i}}}const c=(document.body.textContent||"").match(/totaal[^€]*€\s*([\d.,]+)/i);if(c){const r=l(c[1]);if(r&&r>0)return r}const e=y();return e&&e>0?e:null},getCurrency:()=>"EUR"},it={isCheckoutPage:()=>{const t=window.location.href,n=t.includes("/cart")||t.includes("/checkout"),o=document.querySelector('.sticky.top-8, [class*="cart-summary"], [data-testid*="summary"]')!==null;return n||o},extractTotal:()=>{const t=document.querySelector(".sticky.top-8 span.whitespace-nowrap.transition-colors.font-bold");if(t){const e=l(t.textContent);if(e&&e>0)return e}const n=document.querySelector('.sticky.top-8, [class*="cart-summary"], [data-testid*="summary"]');if(n){const e=n.querySelectorAll("div, span");for(const r of Array.from(e)){const s=(r.textContent||"").toLowerCase();if(/\btotaal\b/.test(s)||/\btotal\b/.test(s)){const a=r.querySelector("span.whitespace-nowrap.transition-colors.font-bold, b, strong, span"),u=l(a?.textContent);if(u&&u>0)return u}}}const o=(n?.textContent||document.body.textContent||"").match(/totaal[^€]*€\s*([\d.,]+)/i);if(o){const e=l(o[1]);if(e&&e>0)return e}const c=y();return c&&c>0?c:null},getCurrency:()=>"EUR"},ut={isCheckoutPage:()=>{const t=window.location.href,n=t.includes("/winkelmand")||t.includes("/checkout"),o=document.querySelector('div.border-y.py-4, [data-testid*="totals"], [class*="totals"]')!==null;return n||o},extractTotal:()=>{const t=document.querySelector("span.w-full.text-right.text-lg.font-semibold.mb-0");if(t){const e=l(t.textContent);if(e&&e>0)return e}const n=document.querySelector("div.border-y.py-4");if(n){const e=n.querySelectorAll("div.w-full.flex.items-center.justify-between");for(const r of Array.from(e)){const a=(r.querySelector("div, span")?.textContent||"").toLowerCase();if(a.includes("totaal")&&a.includes("incl. btw")){const u=r.querySelector("span, b, strong"),i=l(u?.textContent);if(i&&i>0)return i}}}const o=(n?.textContent||document.body.textContent||"").match(/totaal\s*\(incl\.?\s*btw\)[^€\d]*([€]?[\s\d.,-]+)/i);if(o){const e=l(o[1]);if(e&&e>0)return e}const c=y();return c&&c>0?c:null},getCurrency:()=>"EUR"},dt={isCheckoutPage:()=>{const t=window.location.href;return t.includes("/winkelmand")||t.includes("/checkout")||document.querySelector('[class*="winkelmand"]')!==null},extractTotal:()=>{const t=['[class*="total"] [class*="price"]','[class*="winkelmand"] [class*="total"]',".checkout-summary .total",'[data-test*="totals"], [data-testid*="totals"], [data-qa*="totals"]'],n=[];for(const e of t){const r=document.querySelectorAll(e);for(const s of r){if(S(s))continue;const a=l(s.textContent);if(!a||a<=0)continue;const u=s.getBoundingClientRect();let i=0;const d=(s.closest("tr, li, div, p")?.textContent||"").toLowerCase();/(totaal|total|order\s*total)/.test(d)&&(i+=8),/(subtotaal|subtotal)/.test(d)&&(i-=4),n.push({amount:a,top:u.top+window.scrollY,left:u.left+window.scrollX,score:i})}}if(n.length>0){const e=n.sort((s,a)=>a.score-s.score||s.top-a.top||s.left-a.left),r=e[e.length-1];if(r&&r.amount>0)return r.amount}const c=(document.body.textContent||"").match(/(?:totaal|total)[^\n€]*€?\s*([\d.,\s-]+)/i);if(c){const e=l(c[1]);if(e&&e>0)return e}{const e=y();if(e&&e>0)return e}return null},getCurrency:()=>"EUR"},mt={isCheckoutPage:()=>{const t=window.location.href,n=t.includes("/cart")||t.includes("/checkout"),o=document.querySelector(".order-total .cart-footer-total")!==null;return n||o},extractTotal:()=>{const t=document.querySelector(".order-total .cart-footer-total .cart-footer__item--val.order-value.js-order-value");if(t){const c=t.getAttribute("data-price-without-shipping");if(c&&/^\d+(?:[.,]\d+)?$/.test(c)){const r=parseFloat(c.replace(",","."));if(Number.isFinite(r)&&r>0)return r}const e=l(t.textContent);if(e&&e>0)return e}const n=document.querySelector(".js-order-summary.order-totals-summary, .order-total");if(n){const e=(n.textContent||"").match(/totaal[^€]*€\s*([\d.,]+)/i);if(e){const r=l(e[1]);if(r&&r>0)return r}}const o=(()=>{const c=document.querySelectorAll(".order-total, .order-totals, .js-order-summary.order-totals-summary");for(const e of Array.from(c)){const r=y();if(r&&r>0)return r}return null})();return o&&o>0?o:null},getCurrency:()=>"EUR"},ft={isCheckoutPage:()=>{const t=window.location.href;return t.includes("thuisbezorgd.nl")&&(t.includes("/checkout")||t.includes("/basket")||document.querySelector('[class*="checkout"], [class*="order"], [class*="payment"], [data-qa*="order-summary"], [data-qa*="total"]')!==null)},extractTotal:()=>{const t=document.querySelector('[data-qa="order-summary-item-total-label"]');if(t){let r=t.closest("div, section, li");for(let s=0;s<4&&r;s++){const a=r.querySelector('[data-qa="order-summary-item-total-amount"]');if(a){const u=l(a.textContent);if(u&&u>0)return u}r=r.parentElement}}const n=document.querySelector('[data-qa="order-summary-item-total-amount"]');if(n){const r=l(n.textContent);if(r&&r>0)return r}const o=document.querySelector('[data-qa*="order-summary"], [class*="order-summary"]');if(o){const r=o.querySelectorAll("div, span, strong");for(const a of Array.from(r)){const u=(a.textContent||"").toLowerCase();if(/\btotaal\b/.test(u)&&/€/.test(u)){const i=l(a.textContent);if(i&&i>0)return i}}const s=Array.from(r).find(a=>/\btotaal\b/i.test(a.textContent||""));if(s){const u=(s.closest("div, section, li")||o)?.querySelector('[data-qa="order-summary-item-total-amount"], strong, span'),i=l(u?.textContent);if(i&&i>0)return i}}const c=(o?.textContent||document.body.textContent||"").match(/totaal[^€]*([€]?[\s\d.,-]+)/i);if(c){const r=l(c[1]);if(r&&r>0)return r}const e=y();return e&&e>0?e:null},getCurrency:()=>"EUR"};function pt(t){return t.includes("xenos.nl")?B:t.includes("beterbed.nl")?I:t.includes("dille-kamille.nl")?O:t.includes("m.uber.com")?$:t.includes("efteling.com")?V:t.includes("gall.nl")?K:t.includes("prenatal.nl")?G:t.includes("cadeaubon.nl")?H:t.includes("amazon")?j:t.includes("airbnb")?Q:t.includes("zalando")?X:t.includes("bol.com")?Y:t.includes("nike")?Z:t.includes("coolblue")?tt:t.includes("mediamarkt")?et:t.includes("ikea")?ot:t.includes("hema")?rt:t.includes("decathlon")?nt:t.includes("hm.com")?ct:t.includes("debijenkorf")?st:t.includes("etos")?at:t.includes("douglas")?lt:t.includes("gamma")?it:t.includes("vvvcadeaukaarten")?ut:t.includes("wehkamp")?dt:t.includes("rituals")?mt:t.includes("thuisbezorgd")?ft:J}function yt(){P||W();const t=window.location.hostname,n=window.location.href;if(n.startsWith("chrome://")||n.startsWith("chrome-extension://")||n.startsWith("brave://")||n.startsWith("edge://")||n.startsWith("firefox://")||n.startsWith("moz-extension://")||n.startsWith("about:")||n.startsWith("file://")||n.includes("billing.stripe.com")||n.includes("checkout.stripe.com")||n.includes("js.stripe.com"))return console.log("[Woolsocks] Skipping browser internal page or payment service page:",n),null;const o=pt(t);if(!o.isCheckoutPage())return null;const e=o.extractTotal();return{total:e&&e>0?e:0,currency:o.getCurrency(),merchant:t,timestamp:Date.now()}}function ht(t,n){let o=null,c=0;return function(...e){const r=Date.now();r-c>n?(t(...e),c=r):(o&&clearTimeout(o),o=window.setTimeout(()=>{t(...e),c=Date.now()},n-(r-c)))}}const b=ht(()=>{const t=yt();if(t)try{chrome.storage.local.get("user",n=>{if(!(!n?.user?.settings?.qaBypassVoucherDismissal&&L(window.location.hostname)))if(t.total&&t.total>0){if(k!==t.total){chrome.runtime.sendMessage({type:"CHECKOUT_DETECTED",checkoutInfo:t}),E(t),k=t.total,T();const c=document.getElementById("woolsocks-cashback-prompt");c&&c.remove()}}else D(b)})}catch{if(L(window.location.hostname))return;if(t.total&&t.total>0){if(k!==t.total){chrome.runtime.sendMessage({type:"CHECKOUT_DETECTED",checkoutInfo:t}),E(t),k=t.total,T();const n=document.getElementById("woolsocks-cashback-prompt");n&&n.remove()}}else D(b)}},500);b();let R=window.location.href;const gt=setInterval(()=>{const t=window.location.href;t!==R&&(R=t,b())},1e3),U=new MutationObserver(t=>{t.filter(o=>{if(o.type==="characterData")return!1;const c=e=>{if(!(e instanceof Element))return!1;const r=e;return!!(r.id?.includes("woolsocks")||r.closest('[id*="woolsocks"]'))};if(o.type==="childList"){const e=Array.from(o.addedNodes);for(const s of e)if(c(s))return!1;const r=Array.from(o.removedNodes);for(const s of r)if(c(s))return!1}if(o.target instanceof Element){const e=o.target;if(e.id?.includes("woolsocks")||e.closest('[id*="woolsocks"]'))return!1}return!0}).length>0&&b()});U.observe(document.body,{childList:!0,subtree:!0,attributes:!1});function M(){U.disconnect(),clearInterval(gt),T()}window.addEventListener("beforeunload",M);typeof window<"u"&&(window.__woolsocksCleanup=M);
